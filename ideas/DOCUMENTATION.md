# Документація проекту QuantumTrader

## 1. Огляд проекту

**QuantumTrader** — це автоматизований торговий бот, призначений для високочастотного скальпінгу на ринку криптовалютних ф'ючерсів біржі Binance. Бот використовує асинхронну архітектуру для обробки ринкових даних в реальному часі та реалізує стратегії, засновані на аналізі потоку ордерів (Order Flow) та технічних індикаторах.

Основна мета — ідентифікація короткострокових ринкових неефективностей та їх використання для отримання прибутку.

## 2. Архітектура

Проект побудований на модульній та асинхронній архітектурі, що забезпечує високу продуктивність та легкість розширення.

**Ключові компоненти:**

- **`BotOrchestrator`**: "Мозок" системи. Керує всіма процесами: від вибору торгових пар до управління життєвим циклом угод.
- **`BinanceClient`**: Асинхронний клієнт для взаємодії з REST API та WebSocket потоками Binance.
- **`SymbolScreener`**: Модуль для динамічного відбору найбільш ліквідних торгових інструментів.
- **`IndicatorManager`**: Керує завантаженням, кешуванням та розрахунком технічних індикаторів (ATR, MA, і т.д.) для всіх активних символів.
- **`OrderBookManager`**: Локальне представлення біржового стакану для кожної торгової пари, що синхронізується в реальному часі.
- **`TradeExecutor`**: Виконує торгові сигнали, що надходять від стратегій, розраховує розмір позиції та керує ордерами.
- **`PositionManager`**: Відстежує стан усіх відкритих позицій та зберігає його для відновлення у разі перезапуску.
- **Стратегії (`strategies/`)**: Ізольовані модулі, що містять торгову логіку.

## 3. Структура файлів

```
QuantumTrader/
├─── core/                  # Ядро системи
│    ├─── bot_orchestrator.py   # Головний клас-оркестратор
│    ├─── binance_client.py     # Клієнт для API Binance
│    ├─── indicator_manager.py  # Управління індикаторами
│    ├─── orderbook_manager.py  # Управління біржовим стаканом
│    ├─── position_manager.py   # Управління відкритими позиціями
│    ├─── symbol_screener.py    # Відбір торгових пар
│    └─── trade_executor.py     # Виконання угод
├─── strategies/            # Торгові стратегії
│    ├─── base_strategy.py      # Абстрактний клас для стратегій
│    └─── ...
├─── backtesting/           # Фреймворк для тестування стратегій
│    └─── backtester.py
├─── configs/               # Конфігураційні файли
│    ├─── trading_config.json   # Загальні налаштування торгівлі
│    ├─── strategies.json       # Правила призначення стратегій
│    └─── parameters.json       # Параметри для стратегій
├─── logs/                  # Файли логів
├─── main.py                # Точка входу в додаток
└─── requirements.txt       # Залежності проекту
```

## 4. Детальний опис модулів

### `core/bot_orchestrator.py`

Клас `BotOrchestrator` є центральним вузлом системи.

- **`__init__`**: Завантажує конфігурації з `trading_config.json`, `strategies.json` та `parameters.json`.
- **`start`**: Основний метод, що запускає всю логіку:
    1.  Ініціалізує `BinanceClient`.
    2.  Запускає `_generate_strategy_configs` для створення списку активних стратегій на основі правил з `strategies.json`.
    3.  Ініціалізує `IndicatorManager` для активних символів.
    4.  Поетапно (батчами) створює `OrderBookManager` та `TradeExecutor` для кожної активної стратегії.
    5.  Запускає основні фонові задачі (`_user_data_listener`, `_market_and_trade_data_listener`, `indicator_manager.run_updates` та моніторинг для кожного `TradeExecutor`) під наглядом "супервізора" `_start_supervised_task` для відмовостійкості.

### `core/indicator_manager.py`

Клас `IndicatorManager` відповідає за все, що пов'язано з технічними індикаторами.

- **`initialize`**: При першому запуску завантажує історичні дані (K-лінії) для всіх активних символів.
- **`_calculate_indicators`**: На основі завантажених даних розраховує необхідні індикатори (ATR, коефіцієнт волатильності, ковзні середні тощо) за допомогою бібліотеки `pandas-ta`.
- **`run_updates`**: Періодично оновлює дані, довантажуючи останні свічки, та перераховує індикатори.
- **`get_indicator`**: Надає `TradeExecutor` та стратегіям доступ до останніх значень індикаторів.

## 5. Бектестінг

В директорії `backtesting/` знаходиться фреймворк для тестування стратегій на історичних даних.

- **`backtester.py`**: Містить ключові класи:
    - **`DataFeeder`**: Читає історичні дані угод з CSV файлу.
    - **`SimulatedBinanceClient`**: Імітує роботу API Binance, включаючи створення/скасування ордерів, розрахунок комісій та прослизання.
    - **`BacktestOrchestrator`**: Головний клас, що запускає процес бектесту для конкретної стратегії та набору даних, імітуючи роботу реального `BotOrchestrator`.
- **`run_backtest.py`**: Скрипт для запуску бектесту з командного рядка.

## 6. Конфігурація

Гнучкість бота забезпечується трьома основними конфігураційними файлами:

### `configs/trading_config.json`

Містить глобальні налаштування торгівлі та ризик-менеджменту:
- `margin_per_trade_pct`: Відсоток від балансу, що виділяється на одну угоду.
- `leverage`: Кредитне плече.
- `max_active_trades`: Максимальна кількість одночасно відкритих позицій.
- `max_concurrent_symbols`: Максимальна кількість символів для моніторингу.

### `configs/strategies.json`

Файл з правилами призначення стратегій. Дозволяє гнучко призначати стратегії на конкретні символи або на топ-N символів за обсягом.
- `strategy_name`: Назва класу стратегії.
- `assign_to`: Список символів (напр., `["BTCUSDT", "ETHUSDT"]`) або ключове слово `"AUTO"` для автоматичного вибору.
- `enabled`: `true` або `false` для активації/деактивації правила.

### `configs/parameters.json`

Містить шаблони параметрів для кожної стратегії. Це дозволяє уникнути дублювання і легко керувати параметрами.

```json
{
  "LiquidityHunting": {
    "default": {
      "wall_volume_multiplier": 10,
      "risk_reward_ratio": 1.5,
      // ... інші параметри
    }
  },
  "MACrossover": {
    "default": {
        "fast_ma": 10,
        "slow_ma": 30,
        // ...
    }
  }
}
```

## 7. Як запустити

1.  **Встановіть залежності:**
    ```bash
    pip install -r requirements.txt
    ```
2.  **Створіть файл `.env`** в корені проекту та додайте ваші API ключі:
    ```
    BINANCE_API_KEY="your_api_key"
    BINANCE_API_SECRET="your_api_secret"
    ```
3.  **Налаштуйте конфігурації** в папці `configs/` відповідно до вашої торгової стратегії та ризик-профілю.
4.  **Запустіть бота:**
    ```bash
    python main.py
    ```
